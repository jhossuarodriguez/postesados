---
import ChartSpline from "@/assets/icons/chart-spline.svg";
import PrevButton from "@/assets/icons/prevButton.svg";
import NextButton from "@/assets/icons/nextButton.svg";

const slidesData = [
    {
        src: "/images/PROJECTS_IMAGES/pilar-tablestacas.webp",
        alt: "Técnicos operando gato hidráulico.",
        category: "Postensado",
    },
    {
        src: "/images/PROJECTS_IMAGES/armado-puente.webp",
        alt: "Inyección técnica de lechada.",
        category: "Inyección",
    },
    {
        src: "/images/tetrapodos-rompeolas-san-pedro-macoris.webp",
        alt: "Línea de tetrápodos rompeolas.",
        category: "Buildings",
    },
    {
        src: "/images/PROJECTS_IMAGES/soldadura-pilotes-acero.webp",
        alt: "Mantenimiento preventivo.",
        category: "Buildings",
    },
];
---

<section
    id="projectsCarousel"
    class="flex flex-col w-full mt-10 lg:mt-20 lg:pt-20 overflow-hidden"
>
    <div class="flex flex-col px-4 lg:px-10 2xl:ml-60 space-y-10">
        <div
            class="rounded-full border border-gray-300 lg:px-6 px-3 py-2 w-48 lg:w-64"
        >
            <p
                class="flex justify-center items-center text-xs lg:text-base text-[#0032A0] font-bold gap-2"
            >
                <ChartSpline />
                Nuestras soluciones
            </p>
        </div>
        <div
            class="flex flex-col lg:flex-row items-center gap-x-20 space-y-3 lg:space-y-0"
        >
            <p class="text-3xl lg:text-7xl text-[#0032A0] w-full">
                Soluciones <span class="font-bold text-[#0032A0]"
                    >Integrales</span
                >
                <br />en <span class="text-[#0032A0] font-bold"
                    >Hormigón Pretensado</span
                >
            </p>
            <div class="mb-5">
                <p class="text-balance lg:text-[18px] pt-2 lg:pt-0">
                    Desde el diseño y suministro hasta la instalación final.
                    Ofrecemos eficiencia estructural y durabilidad.
                </p>
            </div>
        </div>
    </div>

    {/* Contenedor del Slider */}
    <div
        class="splide splide-projects w-full h-125 lg:h-134.75 mt-20"
        aria-label="Proyectos Destacados"
    >
        <div class="splide__track h-full translate-x-0 2xl:translate-x-28">
            <ul class="splide__list h-full flex items-center">
                {
                    slidesData.map((slide) => (
                        <li class="splide__slide relative flex items-center justify-center">
                            <div class="w-full h-125 lg:h-134.75 rounded-xl relative overflow-hidden group shadow-md">
                                <div class="absolute inset-0 bg-linear-to-t from-black/90 via-black/40 to-transparent z-10 pointer-events-none transition-opacity duration-500 group-hover:from-black/95" />

                                <img
                                    src={slide.src}
                                    alt={slide.alt}
                                    class="w-full h-full object-cover transform transition-transform duration-200 group-hover:scale-110 z-0"
                                />

                                <a
                                    href="#"
                                    class="absolute top-4 right-4 z-20 w-12 h-12 bg-white rounded-full hidden lg:flex items-center justify-center text-gray-800 text-2xl shadow-md hover:scale-105 transition-transform duration-200"
                                >
                                    +
                                </a>

                                <div class="absolute inset-x-0 bottom-0 p-6 flex flex-col justify-end items-start z-20 pointer-events-none pb-8">
                                    <div class="relative z-20">
                                        <h3 class="text-white text-3xl md:text-6xl font-extrabold tracking-tight drop-shadow-md">
                                            {slide.category}
                                        </h3>
                                    </div>

                                    <div class="grid grid-rows-[0fr] group-hover:grid-rows-[1fr] transition-[grid-template-rows] duration-200 ease-out w-full">
                                        <div class="overflow-hidden">
                                            <p class="font-general-sans text-base md:text-lg font-medium text-gray-200 pt-2 opacity-0 transition-opacity duration-700 delay-100 group-hover:opacity-100">
                                                {slide.alt}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    ))
                }
            </ul>
        </div>
    </div>

    <div
        class="flex items-center justify-center mt-8 gap-9 bg-[#e7ecf6] rounded-full w-56 py-1.5 mx-auto"
    >
        <button
            id="prevBtnProjects"
            class="bg-white/90 hover:bg-white text-gray-800 p-2 rounded-full shadow-lg transition-all duration-200 cursor-pointer"
        >
            <PrevButton />
        </button>

        <div class="flex space-x-2">
            <button
                class="dot-projects w-3 h-3 bg-[#0032A0] rounded-full transition-opacity duration-200"
                data-slide="0"></button>
            {
                slidesData
                    .slice(1)
                    .map((_, index) => (
                        <button
                            class="dot-projects w-3 h-3 bg-gray-300 rounded-full transition-opacity duration-200"
                            data-slide={index + 1}
                        />
                    ))
            }
        </div>

        <button
            id="nextBtnProjects"
            class="bg-white/90 hover:bg-white text-gray-800 p-2 rounded-full shadow-lg transition-all duration-200 cursor-pointer"
        >
            <NextButton />
        </button>
    </div>
</section>

<script>
    import Splide from "@splidejs/splide";
    import "@splidejs/splide/css";

    document.addEventListener("DOMContentLoaded", () => {
        const splide = new Splide(".splide-projects", {
            type: "loop",
            autoplay: true,
            interval: 5000,
            arrows: false,
            pagination: false,
            fixedWidth: "427px",
            perMove: 1,
            gap: "1.5rem",

            padding: { left: 0, right: "5%" },

            breakpoints: {
                1024: {
                    fixedWidth: 0,
                    perPage: 2,
                    gap: "1rem",
                    padding: { left: 0, right: "6rem" },
                },
                640: {
                    fixedWidth: 0,
                    perPage: 1,
                    gap: "1rem",
                    padding: { left: 0, right: "3rem" },
                },
            },
        }).mount();

        const prevBtn = document.getElementById("prevBtnProjects");
        const nextBtn = document.getElementById("nextBtnProjects");
        const dots = document.querySelectorAll(".dot-projects");

        prevBtn?.addEventListener("click", () => splide.go("<"));
        nextBtn?.addEventListener("click", () => splide.go(">"));

        dots.forEach((dot, index) => {
            dot.addEventListener("click", () => splide.go(index));
        });

        splide.on("moved", (newIndex) => {
            const activeIndex = newIndex % dots.length;
            dots.forEach((dot, index) => {
                if (index === activeIndex) {
                    dot.classList.remove("bg-gray-300");
                    dot.classList.add("bg-[#0032A0]");
                } else {
                    dot.classList.remove("bg-[#0032A0]");
                    dot.classList.add("bg-gray-300");
                }
            });
        });
    });
</script>
