---
import MoveRight from "@/assets/icons/MoveRight.svg";
import Menu from "@/assets/icons/Menu.svg";
import X from "@/assets/icons/XButton.svg";
import NextButton from "@/assets/icons/nextButton.svg";
const navItems = [
    { label: "Inicio", href: "/" },
    { label: "Nosotros", href: "/nosotros" },
    { label: "Servicios", href: "/servicios" },
    { label: "Tecnologia", href: "/tecnologia" },
    { label: "Contacto", href: "/contacto", class: "md:hidden lg:hidden" },
];
---

<header
    class="fixed mt-5 inset-x-0 mx-auto w-[93%] md:w-[94%] md:max-w-335 lg:max-w-400 shadow-3xl z-50 bg-[#000070] rounded-xl px-4"
    id="main-header"
>
    <nav class="py-2 relative z-50" id="header-content">
        <div class="flex justify-between items-center">
            <div class="flex items-center gap-1">
                <div
                    class="hidden lg:flex items-center justify-center rounded-full hover:bg-[#0000a0] transition-all duration-200 ease-in-out mr-7 px-3 py-3"
                >
                    <button
                        class="cursor-pointer size-6 rounded-full relative flex items-center justify-center"
                        id="menuBtn"
                        aria-expanded="false"
                        aria-controls="menu"
                    >
                        <Menu
                            class="text-white absolute transition-all duration-300"
                            id="menu-icon"
                        />
                        <X
                            id="close-icon"
                            class="text-white absolute opacity-0 scale-0 transition-all duration-300"
                        />
                    </button>
                </div>

                {
                    navItems.map((item, index) => (
                        <a
                            href={item.href}
                            title="Menu de Navegacion"
                            aria-label="Menu de Navegacion"
                            aria-labelledby="Menu de Navegacion"
                            class={`nav-links hidden md:block opacity-80 hover:opacity-100 px-6 py-2 text-white text-base hover:bg-[#0000a0] rounded-full transition-colors ${
                                index === 0
                                    ? "bg-[#0000a0] rounded-full opacity-100"
                                    : ""
                            } ${item.class || ""}`}
                        >
                            {item.label}
                        </a>
                    ))
                }
                <a
                    href="/"
                    title="Logo Postesados"
                    aria-label="Logo Postesados"
                    aria-labelledby="Logo Postesados"
                >
                    <img
                        src="/logo_postesados_nobg.webp"
                        alt="Postesados Logo"
                        class="h-16 w-auto md:ml-14 xl:ml-24 2xl:ml-48"
                        width="120"
                        height="64"
                        fetchpriority="high"
                    />
                </a>
            </div>

            <div class="flex justify-center items-center gap-2">
                <a
                    href="/contact"
                    class="flex gap-2 text-white font-bold text-sm rounded-full opacity-80 hover:opacity-100 bg-[#0000a0] px-3 py-1 group"
                    id="contactBtn"
                    title="Contactanos"
                    aria-label="Contactanos"
                    aria-labelledby="Contactanos"
                    >Contactanos
                    <MoveRight
                        class="lg:inline-block ml-2 hidden group-hover:translate-x-1 duration-100"
                    />
                </a>

                <button
                    class="lg:hidden cursor-pointer relative flex items-center justify-center size-9 rounded-full transition-all duration-300"
                    id="mobile-menuBtn"
                    aria-expanded="false"
                    aria-controls="mobile-menu"
                >
                    <Menu
                        class="text-white size-6 transition-all duration-300"
                        id="mobile-menu-icon"
                    />
                    <X
                        id="mobile-close-icon"
                        class="size-6 text-white absolute opacity-0 scale-0 transition-all duration-300"
                    />
                </button>
            </div>
        </div>
    </nav>
</header>

<!-- Desktop Dropdown Menu -->
<div
    class="fixed top-24 left-1/2 -translate-x-1/2 w-[93%] md:w-[94%] md:max-w-335 lg:max-w-400 bg-[#000070] rounded-xl shadow-xl z-40 transform -translate-y-8 opacity-0 invisible transition-all duration-300 ease-out hidden lg:block"
    id="menu-dropdownn"
>
    <div
        class="p-6 mx-10 grid grid-cols-3 gap-6 py-10 mt-10 max-h-125 min-h-110 2xl:max-h-150 2xl:min-h-125"
    >
        <div class="space-y-4">
            <h3
                class="text-white font-semibold text-lg border-b border-white/20 pb-2"
                title="Servicios"
                aria-label="Servicios"
                aria-labelledby="Servicios"
            >
                Servicios
            </h3>
            <a
                href="/servicios#postesado"
                class="menu-dropdownn-link flex items-center justify-between text-white/80 hover:text-white hover:bg-[#0000a0] px-3 py-2 rounded-xl transition-colors group/section"
                title="Postesado"
                aria-label="Postesado"
                aria-labelledby="Postesado"
                >Postesado
                <div
                    class="flex items-center justify-center border border-white rounded-[10px] p-1 group-hover/section:bg-white"
                >
                    <MoveRight class="size-5 group-hover/section:text-[#000070] group-hover/section:translate-x-1 duration-75" />
                </div>
            </a>
            <a
                href="/servicios#inyeccion"
                class="menu-dropdownn-link flex items-center justify-between text-white/80 hover:text-white hover:bg-[#0000a0] px-3 py-2 rounded-xl transition-colors group/section"
                title="Inyección de Lechada"
                aria-label="Inyección de Lechada"
                aria-labelledby="Inyección de Lechada"
                >Inyección de Lechada
                <div
                    class="flex items-center justify-center border border-white rounded-[10px] p-1 group-hover/section:bg-white"
                >
                    <MoveRight class="size-5 group-hover/section:text-[#000070] group-hover/section:translate-x-1 duration-75" />
                </div>
            </a>
            <a
                href="/servicios#suministro"
                class="menu-dropdownn-link flex items-center justify-between text-white/80 hover:text-white hover:bg-[#0000a0] px-3 py-2 rounded-xl transition-colors group/section"
                title="Suministro de Materiales"
                aria-label="Suministro de Materiales"
                aria-labelledby="Suministro de Materiales"
                >Suministro de Materiales
                <div
                    class="flex items-center justify-center border border-white rounded-[10px] p-1 group-hover/section:bg-white"
                >
                    <MoveRight class="size-5 group-hover/section:text-[#000070] group-hover/section:translate-x-1 duration-75" />
                </div>
            </a>
            <a
                href="/servicios#prefabricados"
                class="menu-dropdownn-link flex items-center justify-between text-white/80 hover:text-white hover:bg-[#0000a0] px-3 py-2 rounded-xl transition-colors group/section"
                title="Prefabricados"
                aria-label="Prefabricados"
                aria-labelledby="Prefabricados"
                >Prefabricados
                <div
                    class="flex items-center justify-center border border-white rounded-[10px] p-1 group-hover/section:bg-white"
                >
                    <MoveRight class="size-5 group-hover/section:text-[#000070] hover:translate-x-1 duration-75" />
                </div>
            </a>
            <a
                href="/servicios"
                class="menu-dropdownn-link flex items-center justify-between text-white font-semibold hover:bg-[#0000a0] px-3 py-2 transition-colors mt-2 group/section"
                title="Ver todos los servicios"
                aria-label="Ver todos los servicios"
                aria-labelledby="Ver todos los servicios"
                >Ver todos
                <div
                    class="flex items-center justify-center border border-white rounded-[10px] p-1 group-hover/section:bg-white group"
                >
                    <MoveRight class="size-5 group-hover/section:text-[#000070] group-hover/section:translate-x-1 duration-75" />
                </div>
            </a>
        </div>
        <div class="space-y-4">
            <button
                class="text-white font-semibold text-lg border-b border-white/20 pb-2 cursor-pointer"
                title="Empresa"
                aria-label="Empresa"
                aria-labelledby="Empresa"
                id="empresa"
            >
                Empresa
            </button>
            <a
                href="/nosotros"
                class="menu-dropdownn-link block text-white/80 hover:text-white hover:bg-[#0000a0] px-3 py-2 rounded-lg transition-colors"
                title="Nosotros"
                aria-label="Nosotros"
                aria-labelledby="Nosotros">Nosotros</a
            >
            <a
                href="/equipo"
                class="menu-dropdownn-link block text-white/80 hover:text-white hover:bg-[#0000a0] px-3 py-2 rounded-lg transition-colors"
                title="Equipo"
                aria-label="Equipo"
                aria-labelledby="Equipo"
                >Equipo
            </a>
            <a
                href="/proyectos"
                class="menu-dropdownn-link block text-white/80 hover:text-white hover:bg-[#0000a0] px-3 py-2 rounded-lg transition-colors"
                title="Proyectos"
                aria-label="Proyectos"
                aria-labelledby="Proyectos">Proyectos</a
            >
        </div>
        <div class="space-y-4">
            <h3
                class="text-white font-semibold text-lg border-b border-white/20 pb-2"
                title="Legal"
                aria-label="Legal"
                aria-labelledby="Legal"
            >
                Legal
            </h3>
            <a
                href="/privacidad"
                class="menu-dropdownn-link block text-white/80 hover:text-white hover:bg-[#0000a0] px-3 py-2 rounded-lg transition-colors"
                title="Privacidad"
                aria-label="Privacidad"
                aria-labelledby="Privacidad"
                >Privacidad
            </a>
            <a
                href="/terminos"
                class="menu-dropdownn-link block text-white/80 hover:text-white hover:bg-[#0000a0] px-3 py-2 rounded-lg transition-colors"
                title="Términos"
                aria-label="Términos"
                aria-labelledby="Términos">Términos</a
            >
        </div>
    </div>
</div>

<div
    class="fixed inset-0 backdrop-blur-sm z-30 opacity-0 invisible transition-all duration-300 hidden lg:block"
    id="desktop-overlay"
>
</div>

<!--Nav Mobile -->
<nav
    class="fixed inset-0 h-full w-full bg-[#000070] z-40 transform -translate-y-full duration-500 ease-in-out shadow-xl md:hidden opacity-0 invisible"
    id="mobile-menu"
    aria-label="Mobile menu"
>
    <div class="flex flex-col h-full pt-24 pb-8 px-6 mt-10 md:mt-0">
        <div class="flex flex-col gap-2">
            {
                navItems.map((link, index) =>
                    index === navItems.length - 1 ? (
                        <a
                            href={link.href}
                            class="mobile-nav-link mt-20 translate-y-20 py-4 px-6 text-lg font-semibold text-white bg-[#030938] rounded-full text-center shadow-lg "
                            data-index={index}
                            title={link.label}
                            aria-label={link.label}
                            aria-labelledby={link.label}
                        >
                            {link.label}
                            <NextButton class="inline-block size-4 ml-2" />
                        </a>
                    ) : (
                        <a
                            href={link.href}
                            class="mobile-nav-link group flex items-center gap-3 py-4 px-4 text-lg font-medium text-white border-b border-white/25"
                            data-index={index}
                            title={link.label}
                            aria-label={link.label}
                            aria-labelledby={link.label}
                        >
                            <div class="w-full flex justify-between items-center size-4">
                                {link.label}
                                <div class="flex justify-center items-center rounded-sm border border-white">
                                    <NextButton class="size-4" />
                                </div>
                            </div>
                        </a>
                    ),
                )
            }
        </div>
    </div>
</nav>

<style>
    .mobile-nav-link {
        opacity: 0;
        transform: translateY(20px);
        transition:
            opacity 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
            transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .mobile-nav-link--visible {
        opacity: 1;
        transform: translateY(0);
    }
</style>

<script>
    const MobileMenu = () => {
        //Mobile
        const mobileMenu = document.getElementById("mobile-menu");
        const mobileMenuBtn = document.getElementById("mobile-menuBtn");
        const mobileMenuIcon = document.getElementById("mobile-menu-icon");
        const mobileCloseIcon = document.getElementById("mobile-close-icon");
        const mobileNavLinks = document.querySelectorAll(".mobile-nav-link");
        const contactBtn = document.getElementById("contactBtn");

        let isOpen = false;

        const openMobileMenu = () => {
            isOpen = true;
            mobileMenu?.classList.remove(
                "-translate-y-full",
                "opacity-0",
                "invisible",
            );

            mobileMenu?.classList.add(
                "translate-y-0",
                "opacity-100",
                "visible",
            );

            mobileMenuIcon?.classList.add("opacity-0", "scale-0");
            mobileCloseIcon?.classList.remove("opacity-0", "scale-0");
            mobileCloseIcon?.classList.add("opacity-100", "scale-100");

            mobileMenuBtn?.classList.add("bg-[#030938]");
            contactBtn?.classList.add("bg-[#030938]");

            mobileMenuBtn?.setAttribute("aria-expanded", "true");
            document.body.style.overflow = "hidden";

            // Staggered reveal
            mobileNavLinks.forEach((link, index) => {
                setTimeout(
                    () => {
                        link.classList.add("mobile-nav-link--visible");
                    },
                    200 + index * 80,
                );
            });
        };

        const closeMobileMenu = () => {
            isOpen = false;
            mobileMenu?.classList.add("-translate-y-full");
            mobileMenu?.classList.remove("translate-y-0");

            // Show hamburger, hide X
            mobileMenuIcon?.classList.remove("opacity-0", "scale-0");
            mobileCloseIcon?.classList.remove("opacity-100", "scale-100");
            mobileCloseIcon?.classList.add("opacity-0", "scale-0");

            // Remove black circle background
            mobileMenuBtn?.classList.remove("bg-[#030938]");
            contactBtn?.classList.remove("bg-[#030938]");

            mobileMenuBtn?.setAttribute("aria-expanded", "false");
            document.body.style.overflow = "";

            mobileNavLinks.forEach((link) => {
                link.classList.remove("mobile-nav-link--visible");
            });

            mobileMenu?.classList.remove("opacity-100", "visible");
            mobileMenu?.classList.add("opacity-0", "invisible");
        };

        const toggleMenu = () => {
            if (isOpen) {
                closeMobileMenu();
            } else {
                openMobileMenu();
            }
        };

        mobileMenuBtn?.addEventListener("click", toggleMenu);

        //Close Menu when click a link
        mobileNavLinks.forEach((link) => {
            link.addEventListener("click", () => {
                setTimeout(closeMobileMenu, 150);
            });
        });
    };

    MobileMenu();

    const Menu = () => {
        const DROPDOWN = document.getElementById("menu-dropdownn");
        const OVERLAY = document.getElementById("desktop-overlay");
        const MENU_BTN = document.getElementById("menuBtn");
        const MENU_ICON = document.getElementById("menu-icon");
        const MENU_CLOSE_ICON = document.getElementById("close-icon");
        const DROPDOWN_LINKS = document.querySelectorAll(
            ".menu-dropdownn-link",
        );

        let isOpen = false;

        const openMenu = () => {
            isOpen = true;

            // Mostrar overlay con blur
            OVERLAY?.classList.remove("opacity-0", "invisible");
            OVERLAY?.classList.add("opacity-100", "visible");

            // Mostrar dropdown
            DROPDOWN?.classList.remove(
                "-translate-y-8",
                "opacity-0",
                "invisible",
            );
            DROPDOWN?.classList.add("-translate-y-4", "opacity-100", "visible");

            // Cambiar iconos: ocultar hamburguesa, mostrar X
            MENU_ICON?.classList.add("opacity-0", "scale-0");
            MENU_CLOSE_ICON?.classList.remove("opacity-0", "scale-0");
            MENU_CLOSE_ICON?.classList.add("opacity-100", "scale-100");
            MENU_BTN?.classList.add("bg-[#0000a0]");

            MENU_BTN?.setAttribute("aria-expanded", "true");
        };

        const closeMenu = () => {
            isOpen = false;

            OVERLAY?.classList.add("opacity-0", "invisible");
            OVERLAY?.classList.remove("opacity-100", "visible");

            DROPDOWN?.classList.add("-translate-y-8", "opacity-0", "invisible");
            DROPDOWN?.classList.remove(
                "translate-y-0",
                "opacity-100",
                "visible",
            );

            MENU_ICON?.classList.remove("opacity-0", "scale-0");
            MENU_CLOSE_ICON?.classList.remove("opacity-100", "scale-100");
            MENU_CLOSE_ICON?.classList.add("opacity-0", "scale-0");
            MENU_BTN?.classList.remove("bg-[#030938]", "text-white");

            MENU_BTN?.setAttribute("aria-expanded", "false");
        };

        const toggleMenu = () => {
            if (isOpen) {
                closeMenu();
            } else {
                openMenu();
            }
        };

        MENU_BTN?.addEventListener("click", toggleMenu);

        DROPDOWN_LINKS.forEach((link) => {
            link.addEventListener("click", () => {
                setTimeout(closeMenu, 150);
            });
        });

        // Cerrar al hacer click en el overlay
        OVERLAY?.addEventListener("click", closeMenu);

        // Cerrar al hacer click fuera
        document.addEventListener("click", (e) => {
            if (
                isOpen &&
                !DROPDOWN?.contains(e.target as Node) &&
                !MENU_BTN?.contains(e.target as Node)
            ) {
                closeMenu();
            }
        });

        document.addEventListener("keydown", (e) => {
            if (isOpen && e.key === "Escape") {
                closeMenu();
            }
        });

        window.addEventListener("resize", () => {
            if (window.innerWidth >= 768 && isOpen) {
                closeMenu();
            }
        });
    };

    Menu();

    document.addEventListener("astro:after-swap", MobileMenu);
    document.addEventListener("astro:after-swap", Menu);
</script>
